#!/usr/bin/env sh
# <<<AUTOGENERATED - DO NOT MODIFY>>>
#		 > INSTALL.SH
#		 > plantuml
#		 > bin

# Variables
INSTALL_DST="${INSTALL_DST:-${{HOME}}/.local/bin/}"
BASHCOMP_P="${BASHCOMP_P:-${HOME}/.config/bash/bash_completion}"
ZSHCOMP="${ZSHCOMP:-${HOME}/.config/zsh/completions}"
TEMPDIR="$(mktemp -d -t XXXXXXXXXX)"
FMT='\e[0;34m%-6s\e[m\n'
# Commands
DLTMP=$(mktemp -d -t jumpstart-XXXXXXXXXX) \
    && cd "${DLTMP}" \
    && printf "\e[0;34m%-6s\e[m\n" "Downloading to $(realpath .)" \
    && URL=$(curl --silent 'https://api.github.com/repos/plantuml/plantuml/releases/latest' | jq '..|.browser_download_url?' | grep 'uml\.jar"' | tr -d '"') \
    && curl -jLO "${URL}" \
    && DLFILE=$(ls . | head -n1)

# <<<POST STAGE>>>


VER=$(git ls-remote --refs --tags https://github.com/plantuml/plantuml |
      cut --delimiter='/' --fields=3 |
      grep -Eo 'v[0-9]+\.[0-9]+\.[0-9]+' |
      sort --version-sort |
      tr -d 'v' |
      tail --lines=1)
url="http://sourceforge.net/projects/plantuml/files/plantuml.${VER}.jar/download"

# Update .jar file?
# ----------------------------------------------------------------------------------
installdir="${HOME}/.local/share/plantuml"
# installdir="/usr/share/plantuml"
jarpath="${installdir}/plantuml.${VER}.jar"

mkdir -p ${installdir}
[ ! -f "${jarpath}" ] && curl -JLO --output "${jarpath}" "${url}"
ln -s -f "${installdir}/plantuml.${VER}.jar" "${installdir}/plantuml.jar"

# Update executable?
# ----------------------------------------------------------------------------------
wrapperpath="${HOME}/.local/bin/plantuml"
# wrapperpath="/usr/local/bin/plantuml"
DIR="$( cd -- "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
echo $DIR
cp -f "${DIR}/run.sh" "${wrapperpath}"
