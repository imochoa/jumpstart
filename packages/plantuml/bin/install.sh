#!/bin/bash
set -euo pipefail
IFS=$'\n\t'

# <<<AUTOGENERATED - DO NOT MODIFY>>>
#		 >     File: install.sh
#		 >     Name: plantuml
#		 > Template: bin

# Variables

# Commands
DLTMP=$(mktemp -d -t jumpstart-XXXXXXXXXX) \
&& cd "${DLTMP}" \
&& printf "\e[0;34m%-6s\e[m\n" "Downloading to $(realpath .)" \
&& URL=$(curl --silent 'https://api.github.com/repos/plantuml/plantuml/releases/latest' | jq '..|.browser_download_url? | select( . != null )' | tr -d '"' | grep --ignore-case 'uml\.jar"') \
&& curl -jLO "${URL}" \
&& DLFILE=$(ls . | head -n1)

# <<<POST STAGE>>>


# TODO use INSTALL_DST?
installdir="${HOME}/.local/share/plantuml"
# installdir="/usr/share/plantuml"
jarpath="${installdir}/plantuml.jar"
mkdir -p ${installdir}
mv *.jar "${jarpath}"
# ln -s -f "${installdir}/plantuml.${VER}.jar" "${installdir}/plantuml.jar"

# Update executable?
# ----------------------------------------------------------------------------------
# CONSTANTS
DATA_DIR="/home/imochoa/Code/jumpstart/packages/plantuml/bin/data/"
RUN_WRAPPER="${DATA_DIR}/plantuml"

wrapperpath="${HOME}/.local/bin/plantuml"
# wrapperpath="/usr/local/bin/plantuml"
DIR="$(
	cd -- "$(dirname "$0")" >/dev/null 2>&1
	pwd -P
)"
echo $DIR
# cp -f "${DIR}/run.sh" "${wrapperpath}"
cp -f "${RUN_WRAPPER}" "${wrapperpath}"
